<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>A simple WebSocket chat.</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script language="javascript" type="text/javascript">
      $(function() {
        function log(system, uid, msg) {
          $('#log').prepend(
            $('<div>').text(': ' + msg).prepend(
              $('<span>').addClass(system ? 'text-danger' : 'text-success').text(uid)
            )
          );
        }

        var uri = (window.location.protocol=='https:' ? 'wss://' : 'ws://') + window.location.host;
        log(true, '?', 'connecting');

        var conn = new WebSocket(uri);
        conn.onopen    = function()  { log(true, '?', 'connected'); };
        conn.onclose   = function()  { log(true, '?', 'disconnected'); };
        conn.onmessage = function(e) {
          var xs = e.data.split(' ', 2);
          log(xs[0] == 'S', xs[1], e.data.slice(xs[0].length + xs[1].length + 2));
        };

        $('#chatform').on('submit', function () {
          conn.send($('#text').val());
          $('#text').val('').focus();
          return false;
        });
      });
    </script>
    <style>
      .input-group { display: inline-block; }
      .input-group .form-control { width: auto; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Chat!</h1>
      <form id="chatform">
        <div class="input-group">
          <input class="form-control" id="text" type="text" />
          <div class="input-group-btn">
            <button class="btn btn-success" type="submit">Send</button>
          </div>
        </div>
      </form>
      <samp id="log"></samp>
    </div>
  </body>
</html>
